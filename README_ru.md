# Использование Composer вместе с Cotonti #

## Текущие проблемы ##

В текущем стабильном релизе Cotonti ([ветка Сиена](https://github.com/Cotonti/valencia)) у нас имеется встроенный механизм установки Модулей и Плагинов для Cotonti. Данный инсталятор позволяет учитывать зависимости расширений друг от друга, но не учитывает их версии.

Кроме того, текущий релиз имеет следующие узкие места:
1. Нет механизма установки тем оформления аналогичного расширениям. Нет возможности устанавливать сторонние библиотеки или веб-компоненты. Пользователи вынуждены устанавливать их в ручную, контролируя совместимость и настраивая каждый в отдельности.
2. Нет возможности контролировать JS библиотеки используемые в проекте. Многие разработчики поставляют свои расширения с общеиспользуемыми библиотеками (такими как jQuery UI или Bootstrap), что на деле выливается конфликты и ошибки в реальных проектах.
3. Нет абсолютно никакого контроля версий установленных компонент (расширений, тем, библиотек). Отсюда невозможность проверить совместимость или зависимость одного от другого.
4. Нет механизма установки компонент из централизованного репозитория (будь то оф.сайт или ГитХаб).

Решить все эти проблемы внутренними средствами Cotonti не представляется возможным, ни технически, ни материально. Поэтому единственное решение это использовать сторонние проверенные разработки, учитывая возможность их интеграции co встроенным в Cotonti механизмом установки.

Перспективной разработкой для этих целей выглядит [Composer](https://getcomposer.org/) (менеджер зависимостей для PHP). Сейчас Composer уже стандарт де-факто среди PHP разработчиков и пользователей, если речь идет о пакетных менеджерах.

Главным для нашего проекта служит то, что Composer постепенно позволит решить все означенные выше проблемы, к тому же он достаточно прост и расширяем, чтобы интегрировать его с Cotonti без серьезных изменений и максимальной обратной совместимостью.

## Valencia ##

В новой тестовой ветке Cotonti ([кодовое имя Валенсия](https://github.com/Cotonti/valencia)) мы пытаемся разработать методы для интеграции с Composer, а так же выработать правила для упрощения его использования вместе с Cotonti.

### Cotonti как пакет ###

«Валенсия» теперь имеет свой собственный «пакетный» файл (`composer.json`). Т.е. по сути Cotonti теперь может рассматриваться, как законченный Composer-совместимый пакет. И только одно это уже позволяет:

 * во-первых, быстрее проводить начальную установку (скачивание и  разворачивание) на сервере. Как с обычным Composer пакетом мы можем использовать для этого команду `create-project`:
	```
	composer create-project cotonti/valencia [folder] [version]
	```
	Эта команда скачает Cotonti (создаст полную копию репозитория) в указанный каталог `folder`.

 * во-вторых, некоторые необходимые для Cotonti компоненты, поставляемые в составе дистрибутива, теперь прописаны как Composer-совместимые веб-компоненты. На текущий момент, таким образом используется библиотека `jQuery` и CSS фрейворк `Bootstrap`. Это значит, что они могут быть обновлены «в один клик», просто выполнив одну команду в корневом каталоге проекта:
	```
	composer update
	```

## Установка веб-компонент ##

Теперь, с помощью Composer, можно легко устанавливать дополнительные компоненты в ваш проект. Для примера давайте установим пакет [font-awesome](http://fontawesome.io/):
```
composer require components/font-awesome
```
Вот и все. Теперь он лежит в каталоге `lib/components/font-awesome`, и готов к использованию. 

## Package connector ##

В виду, того, что кроме веб-компонент (JS/CSS), мы хотим также полноценно устанавливать (и использовать) PHP библиотеки, нам необходимо задействовать такое мощное средство Composer, как автозагрузчик.
Для этого разработана библиотека «Package Connector» — это класс-расширения для Cotonti, осуществляющий связь с установленными через Composer пакетами.
Главная функция расширения — это подключение сгенерированного через Composer автозагрузчика классов. Кроме этого, расширение предоставляет исчерпывающую информацию об установленных пакетах (такую как имя, версия, автор, зависимости и прочее).

Таким образом, установленный в один клик пакет (для примера: эта команда установит PHP библиотеку [php-markdown](https://michelf.ca/projects/php-markdown/) последней версии (вплоть до версии 2.0):
```
composer require michelf/php-markdown ~1.5
```
с Package Connector'ом  можно использовать, без необходимости писать дополнительные `include` или `require`:
```php
use Michelf\MarkdownExtra;
$parser = new MarkdownExtra;
$my_html = $parser->transform('**Markdown text**');
```
Необходимый класс (`MarkdownExtra`) будет автоматически подгружен.

Более подробная информация о библиотеке может быть найдена в соответствующем  [репозитории на ГитХабе](https://github.com/macik/PackageConnector).


## Установка компонент Cotonti ##

[Раздел в разработке]

# Технические моменты #

